---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';

const posts = await getCollection('blog');

// タグの集計
const tagCounts = new Map();
posts.forEach((post) => {
  if (post.data.tags) {
    post.data.tags.forEach((tag) => {
      const count = tagCounts.get(tag) || 0;
      tagCounts.set(tag, count + 1);
    });
  }
});

// タグを名前順にソート
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => 
  a[0].localeCompare(b[0])
);
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title={`Tags - ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main class="mx-auto max-w-3xl px-4">
			<section class="mb-16">
				<h1 class="text-4xl font-bold text-skin-base mb-4">Tags</h1>
				<p class="text-xl text-skin-base/80 leading-relaxed">すべてのタグ一覧</p>
			</section>
			
			<section>
				{sortedTags.length > 0 ? (
					<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
						{sortedTags.map(([tag, count]) => (
							<a
								href={`/tags/${tag}/`}
								class="group block p-6 bg-skin-card/30 hover:bg-skin-card/50 rounded-lg transition-colors border border-skin-line/20 hover:border-skin-accent/30"
							>
								<div class="flex items-center justify-between">
									<h2 class="text-lg font-semibold text-skin-base group-hover:text-skin-accent transition-colors">
										{tag}
									</h2>
									<span class="text-sm text-skin-base/60 bg-skin-card px-2 py-1 rounded-full">
										{count}
									</span>
								</div>
							</a>
						))}
					</div>
				) : (
					<div class="text-center py-12">
						<p class="text-skin-base/60">タグが見つかりませんでした。</p>
					</div>
				)}
			</section>
		</main>
		<Footer />
	</body>
</html>